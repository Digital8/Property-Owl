extends ../../layout

block content
  
  .container.row.main
  
    include ../menu
    
    h1 Members
    
    include actions

    .grid-header 
      form#search-form(action="/admin/members", method="get")
        input#memberSearch(type="text",placeholder="Name",name="name", value=search)
        &nbsp;
        input.button(type="submit",value="Search")
    
    table.admin-gridview
      thead
        tr
          td Name
          td Email
          td Member Type
          td(colspan='2') Actions
      
      tbody
      - each user in users
        tr
          td #{user.first_name} #{user.last_name}
          
          td= user.email
          
          td= user.account_type
          
          td.actions
            a(href="/admin/members/#{user.user_id}/edit")
              img(src='/images/edit.png', alt='Edit')
              | Edit
          
          td.actions
            a(href="#", data-id="#{user.user_id}").deleteUser
              img(src='/images/delete.png', alt='Delete')
              | Delete
      tfoot
        tr
          td(colspan='5')
            &nbsp;
  script
    $(document).ready(function(){
      $('.deleteUser').click(function(e){
        e.preventDefault();
        var $id = $(this).data('id');
        var $that = $(this);
        if (confirm("Are you sure you want to delete this user? This can not be undone"))
        {
          $.ajax({
            url: '/admin/members/'+$id,
            type: 'delete'
          }).done(function(d){
            if (d.status == 200){
              $that.closest('tr').fadeOut('fast');
            }
            else
            {
              alert('internal error');
            }
          });
        }
      });
    });