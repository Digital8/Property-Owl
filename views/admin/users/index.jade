extends ../../layout

block content
  
  .container.row.main
  
    include ../menu
    
    h1 Members (#{users.length})
    
    include ../../flashify
    
    include actions

    .grid-header 
      form#search-form(action="/users", method="get")
        input#memberSearch(type="text",placeholder="Name",name="name", value=search)
        &nbsp;
        input.button(type="submit",value="Search")
    
    table.admin-gridview.users-gridview.tablesorter
      thead
        tr
          th First Name
          th Last Name
          th Email
          th Member Type
          th Referrer First Name
          th Referrer Last Name
          th(colspan='2') Actions
      
      tbody
      
      - each user in users
        
        tr
          td #{user.first_name}

          td #{user.last_name}
          
          td= user.email
          
          td= user.role
          
          td
            - if (user.referrer)
              a(href="/users/#{user.referrer.id}/edit")= user.referrer.first_name
            - else
              span -
          
          td
            - if (user.referrer)
              a(href="/users/#{user.referrer.id}/edit")= user.referrer.last_name
            - else
              span -
          
          td.actions
            a(href="/users/#{user.user_id}/edit")
              img(src='/images/edit.png', alt='Edit')
              | Edit
          
          td.actions
            a(href="#", data-id="#{user.user_id}").deleteUser
              img(src='/images/delete.png', alt='Delete')
              | Delete
      tfoot
        tr
          td(colspan='8')
            &nbsp;
  
  :coffeescript
    ($ '.users-gridview').tablesorter()
  
  script
    $(document).ready(function(){
      $('.deleteUser').click(function(e){
        e.preventDefault();
        var $id = $(this).data('id');
        var $that = $(this);
        if (confirm("Are you sure you want to delete this user? This can not be undone"))
        {
          $.ajax({
            url: '/users/'+$id,
            type: 'delete'
          }).done(function(d){
            if (d.status == 200){
              $that.closest('tr').fadeOut('fast');
            }
            else
            {
              alert('internal error');
            }
          });
        }
      });
    });
